<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>CasaConnect — Roommate Post Detail</title>
    <link rel="stylesheet" href="common_style.css" />

    <style>
        .phone {
            padding-top: 28px;
        }


        .after-topbar {
            margin-top: 0;
        }

        .wrap {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .card { 
            padding: 8px 0; 
        }
        
        .img-holder { 
            width: 100%; 
            background: #ddd; 
            border-radius: 16px; 
            overflow: hidden; 
        }

        .img-holder img { 
            width: 100%; 
            height: 220px; 
            object-fit: cover; 
            display: block; 
        }

        .skel-row {
            background: #e6e6e6;
            border-radius: 8px;
            padding: 8px 10px;
            font-size: 12px;
            color: #111;
            font-weight: 700;
            display: grid;
            grid-template-columns: 1fr auto;
            align-items: center;
            gap: 8px;
        }


        .info-line {
            background: #e6e6e6;
            border-radius: 8px;
            padding: 6px 10px;
            font-size: 12px;
            color: #111;
            font-weight: 700;
        }


        .img-skel {
            width: 100%;
            height: 320px;
            background: #d9d9d9;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: 800;
            color: #111;
            text-align: center;
        }

        .block {
            background: #e6e6e6;
            border-radius: 8px;
            padding: 12px 14px;
            color: #111;
        }

        .block.title {
            font-weight: 700;
        }


        .block.desc {
            min-height: 200px;
            line-height: 1.5;
            width: 100%;
        }

        .meta-small {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }

        .actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 14px;
            margin-top: 6px;
        }

        .btn-action {
            text-decoration: none;
            color: #fff;
            background: #000;
            border: 2px solid #000;
            border-radius: 10px;
            padding: 12px 14px;
            font-weight: 800;
            font-size: 16px;
            text-align: center;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .like-badge {
            font-weight: 800;
        }

        @media (max-width: 360px) {
            .img-skel {
                height: 320px;
            }
        }
    </style>
</head>

<body class="no-footer">
    <div class="screen">
        <main class="phone">

            <div class="topbar">
                <button class="btn-back" type="button" onclick="smartBack()">Back</button>
            </div>

            <!-- main content -->
            <div class="after-topbar">
                <div class="wrap">

                    <!-- username | year -->
                    <div class="skel-row">
                        <span>username</span>
                        <span>year</span>
                    </div>

                    <!-- image -->
                    <div class="img-skel">Image</div>

                    <!-- place to live -->
                    <div class="info-line">&lt;place to live&gt;</div>

                    <!-- title -->
                    <div class="block title">Post title</div>

                    <!-- description -->
                    <div class="block desc">Description……</div>

                    <!-- meta -->
                    <div class="meta-small">Last edited &lt;time&gt; &lt;IP&gt;</div>


                    <div class="actions">
                        <!-- favorites -->
                        <button class="btn-action" id="favBtn" type="button">
                            <span>favorites</span>
                            <span class="like-badge" id="likeCount">(0)</span>
                        </button>

                        <!-- match link to match confirm page -->
                        <a class="btn-action" href="match_confirm.html">match</a>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>

        function smartBack() {
            if (document.referrer && document.referrer !== location.href) {
                history.back();
            } else {
                const base = location.pathname.replace(/[^\/]+$/, "");
                location.href = base + "home.html";
            }
        }


        function applyTopbarOffset() {
            const topbar = document.querySelector('.topbar');
            const after = document.querySelector('.after-topbar');
            if (!topbar || !after) return;
            const h = Math.ceil(topbar.getBoundingClientRect().height);
            const extra = 8; // extra breathing space
            after.style.marginTop = (h + extra) + 'px';
        }
        window.addEventListener('load', applyTopbarOffset);
        window.addEventListener('resize', applyTopbarOffset);
    </script>

    <!-- fetch roommate posts -->
    <script>
    const API_BASE = "http://127.0.0.1:5000"; // Flask server
    const API_LIST = `${API_BASE}/api/roommates`;

    const esc = s => String(s||"").replace(/[&<>"']/g, c => (
      {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]
    ));

    async function loadPosts(){
      try {
        const r = await fetch(API_LIST);
        const data = await r.json();
        if(!data.success) throw new Error("API error");

        const wrap = document.querySelector(".wrap");
        if (!data.roommates || data.roommates.length === 0) {
          wrap.innerHTML += "<p>No roommate posts yet.</p>";
          return;
        }

        data.roommates.forEach(p => {
          const postHTML = `
            <div class="skel-row">
              <span>${esc(p.username || "username")}</span>
              <span>${esc(p.year || "year")}</span>
            </div>
            <div class="img-skel">Image</div>
            <div class="info-line">&lt;${esc(p.location || "place to live")}&gt;</div>
            <div class="block title">${esc(p.title)}</div>
            <div class="block desc">${esc(p.description)}</div>
            <div class="meta-small">Last edited ${p.updated_at || p.created_at || "—"}</div>
            <div class="actions">
              <button class="btn-action"><span>favorites</span><span class="like-badge">(0)</span></button>
              <a class="btn-action" href="match_confirm.html">match</a>
            </div>
          `;
          const div = document.createElement("div");
          div.className = "post";
          div.innerHTML = postHTML;
          wrap.appendChild(div);
        });
      } catch (e) {
        console.error(e);
        alert("Failed to load posts. Check Flask/CORS.");
      }
    }

    window.addEventListener("load", loadPosts);
    </script>



</body>

</html>